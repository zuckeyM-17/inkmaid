# 2025/12/28 開発ログ #1 - キャンバス全画面化機能の実装

## 概要

プロジェクト詳細ページにキャンバスの全画面化機能を実装しました。ヘッダーだけを残してキャンバスを全画面表示し、Mermaidコードパネル、AI思考ログ、バージョン履歴パネルをオーバーレイ表示で開閉できるようにしました。

## 実装内容

### 1. 全画面モードの実装

#### `apps/web/src/app/projects/[id]/page.tsx`
- `isFullscreen` stateを追加して全画面モードを管理
- 全画面モード時は、ヘッダー以外のコンテンツを非表示にする
- キャンバスサイズを全画面モード時に画面全体に合わせて調整（ヘッダー分を除く）
- 全画面モード切り替えボタンをヘッダーに追加

### 2. Mermaidコードパネルの作成

#### `apps/web/src/components/MermaidCodePanel.tsx`（新規作成）
- Mermaidコードを表示するパネルコンポーネントを作成
- オーバーレイ表示で、z-index: 50でキャンバスの前面に表示
- 開閉可能なUIを実装

#### `apps/web/src/app/projects/[id]/page.tsx`
- `showMermaidCodePanel` stateを追加してパネルの開閉を管理
- ヘッダーにMermaidコードパネルのトグルボタンを追加

### 3. AI思考ログ・履歴パネルのオーバーレイ表示化

#### `apps/web/src/app/projects/[id]/page.tsx`
- AI思考ログパネルとバージョン履歴パネルをオーバーレイ表示に変更
- `fixed`と`absolute`を使用して、z-index: 40でキャンバスの前面に表示
- パネルが開いている時のみレンダリングするように変更

#### `apps/web/src/components/AIThinkingPanel.tsx`
- `border-l`を`border-r`に変更（右側表示に合わせる）
- `h-full`を追加してオーバーレイ表示で正しく動作するように調整

#### `apps/web/src/components/VersionHistoryPanel.tsx`
- `border-l`を`border-r`に変更（右側表示に合わせる）
- `h-full`を追加してオーバーレイ表示で正しく動作するように調整

### 4. AIストリーム開始時の自動表示

#### `apps/web/src/app/projects/[id]/page.tsx`
- `handleConvertWithAI`でAIストリーム開始時に`setShowThinkingPanel(true)`を呼び出し
- AIストリームが始まったら自動的に思考パネルを表示
- ユーザーがボタンで閉じることができる

## 追加/変更したファイル

- `apps/web/src/components/MermaidCodePanel.tsx` - 新規作成（Mermaidコードパネルコンポーネント）
- `apps/web/src/app/projects/[id]/page.tsx` - 全画面モード、Mermaidコードパネル、オーバーレイ表示の実装
- `apps/web/src/components/AIThinkingPanel.tsx` - オーバーレイ表示用のスタイル調整
- `apps/web/src/components/VersionHistoryPanel.tsx` - オーバーレイ表示用のスタイル調整

## UI/UXの改善点

1. **全画面モード**: ヘッダーだけを残してキャンバスを全画面表示することで、より広い作業領域を提供
2. **Mermaidコードパネル**: コードを確認したい時に簡単にアクセスできる
3. **オーバーレイ表示**: パネルがキャンバスの前面に表示されるため、作業を中断せずに情報を確認できる
4. **自動表示**: AIストリーム開始時に自動的に思考パネルを表示することで、ユーザーがAIの処理状況を確認しやすくなる

## 検証

以下のコマンドで型チェックとLintチェックを実行し、すべて通過することを確認：

```bash
# 型チェック
pnpm --filter web exec tsc --noEmit

# Lintチェック
pnpm lint
```

## 次のステップ

- [ ] 全画面モード時のパフォーマンス最適化
- [ ] パネルのアニメーション効果の追加（オプション）
- [ ] キーボードショートカットの追加（Escキーでパネルを閉じるなど）

## 注意事項

- 全画面モード時は、ヘッダー以外のコンテンツ（フィードバックバナー、デバッグ情報など）が非表示になります
- パネルはz-indexで前面に表示されますが、Mermaidコードパネル（z-50）が最も前面に表示されます
- AI思考ログパネルは、AIストリーム開始時に自動的に表示されますが、ユーザーが閉じることができます
